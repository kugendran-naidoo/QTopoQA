Skipped Validating graphs using standalone tool ...
Starting model training ...
[run_full_pipeline] Validating graphs before training...
[validate_graphs] OK: validated 14391 graph(s) in /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/graph_data
[run_full_pipeline] Starting sweep at 2025-12-31T21:20:31.050873+00:00 using manifest /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/manifests/run_lean.yaml
[train_cli][batch] (1/3) running job 'sched_boost_lean_seed222' -> run_name=sched_boost_lean_seed222_2025-12-31_21-20-31
[train_cli] run_id=sched_boost_lean_seed222_2025-12-31_21-20-31 | command=/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/venv_qtopo/bin/python /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/model_train_topoqa_cpu.py --config /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/config/config.yaml --run-dir /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31 --git-commit 16a6153d0a --git-dirty
2025-12-31 21:20:35 INFO git_commit = 16a6153d0a (dirty)
2025-12-31 21:20:35 INFO Training package root: /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2
2025-12-31 21:20:35 INFO Configuration loaded from /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/config/config.yaml
2025-12-31 21:20:35 INFO   graph_dir = /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/graph_data
2025-12-31 21:20:35 INFO   train_label_file = /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/data.train.csv
2025-12-31 21:20:35 INFO   val_label_file = /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/data.validate.csv
2025-12-31 21:20:35 INFO   save_dir = /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31
2025-12-31 21:20:35 INFO   tuning_label_file = /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/stats_split_helper.tuning.csv
2025-12-31 21:20:35 INFO   metadata_path = None
2025-12-31 21:20:35 INFO   summary_path = None
2025-12-31 21:20:35 INFO   accelerator = cpu
2025-12-31 21:20:35 INFO   devices = 1
2025-12-31 21:20:35 INFO   attention_head = 8
2025-12-31 21:20:35 INFO   pooling_type = mean
2025-12-31 21:20:35 INFO   model_self_loops = False
2025-12-31 21:20:35 INFO   model_self_loop_fill = mean
2025-12-31 21:20:35 INFO   model_residual = False
2025-12-31 21:20:35 INFO   batch_size = 48
2025-12-31 21:20:35 INFO   learning_rate = 0.005
2025-12-31 21:20:35 INFO   num_epochs = 140
2025-12-31 21:20:35 INFO   accumulate_grad_batches = 8
2025-12-31 21:20:35 INFO   seed = 222
2025-12-31 21:20:35 INFO   num_workers = 2
2025-12-31 21:20:35 INFO   precision = 32
2025-12-31 21:20:35 INFO   lr_scheduler_type = reduce_on_plateau
2025-12-31 21:20:35 INFO   early_stopping_patience = 24
2025-12-31 21:20:35 INFO   lr_scheduler_patience = 6
2025-12-31 21:20:35 INFO   lr_scheduler_factor = 0.2
2025-12-31 21:20:35 INFO   fast_dev_run = False
2025-12-31 21:20:35 INFO   limit_train_batches = None
2025-12-31 21:20:35 INFO   limit_val_batches = None
2025-12-31 21:20:35 INFO   log_lr = False
2025-12-31 21:20:35 INFO   progress_bar_refresh_rate = 0
2025-12-31 21:20:35 INFO   log_every_n_steps = 100
2025-12-31 21:20:35 INFO   use_val_spearman_as_secondary = True
2025-12-31 21:20:35 INFO   spearman_secondary_min_delta = 0.0
2025-12-31 21:20:35 INFO   spearman_secondary_weight = 1.0
2025-12-31 21:20:35 INFO   selection_primary_metric = val_loss
2025-12-31 21:20:35 INFO   tuning_max_samples = None
2025-12-31 21:20:35 INFO   tuning_fraction = None
2025-12-31 21:20:35 INFO   tuning_eval_every = 1
2025-12-31 21:20:35 INFO   tuning_min_groups_ge2 = 200
2025-12-31 21:20:35 INFO   rank_loss_weight = 0.0
2025-12-31 21:20:35 INFO   rank_loss_margin = 0.0
2025-12-31 21:20:35 INFO   rank_loss_mode = hinge
2025-12-31 21:20:35 INFO   rank_loss_grouped = True
2025-12-31 21:20:35 INFO   variance_reduction_enabled = True
2025-12-31 21:20:35 INFO   variance_reduction_method = ema
2025-12-31 21:20:35 INFO   variance_reduction_top_k = 3
2025-12-31 21:20:35 INFO   variance_reduction_ema_decay = 0.999
2025-12-31 21:20:35 INFO   variance_reduction_swa_start = 0.75
2025-12-31 21:20:35 INFO   variance_reduction_save_every_epochs = 5
2025-12-31 21:20:35 INFO   variance_reduction_resume = True
2025-12-31 21:20:35 INFO   coverage_minimum = 0.0
2025-12-31 21:20:35 INFO   coverage_fail_on_missing = False
2025-12-31 21:20:35 INFO   graph_load_profiling = False
2025-12-31 21:20:35 INFO   graph_load_top_k = 5
2025-12-31 21:20:35 INFO   enable_graph_cache = True
2025-12-31 21:20:35 INFO   graph_cache_size = 256
2025-12-31 21:20:35 INFO   canonicalize_on_load = False
2025-12-31 21:20:35 INFO   mlflow = MlflowConfig(enabled=True, tracking_uri='./ml_runs2', experiment='dynamic_topoqa', run_name=None, log_artifacts=True, tags={})
2025-12-31 21:20:35 INFO   edge_schema = {}
2025-12-31 21:20:35 INFO   topology_schema = {}
Seed set to 222
2025-12-31 21:20:35 INFO [train] label rows: 8723 | usable graphs: 8686 | coverage: 99.58%
2025-12-31 21:20:35 ERROR [train] 37 label entries missing matching .pt graphs (first examples: 1A9X, 1FLE, 1HT9, 1OAO, 1R0R). Regenerate graph tensors or adjust coverage settings to proceed safely.
2025-12-31 21:20:35 INFO [val] label rows: 3397 | usable graphs: 3376 | coverage: 99.38%
2025-12-31 21:20:35 ERROR [val] 21 label entries missing matching .pt graphs (first examples: 1H59, 2B5L, 2C7M, 2GZH, 2W19). Regenerate graph tensors or adjust coverage settings to proceed safely.
2025-12-31 21:20:35 INFO [tuning] label rows: 2181 | usable graphs: 2173 | coverage: 99.63%
2025-12-31 21:20:35 ERROR [tuning] 8 label entries missing matching .pt graphs (first examples: 6K7C, 4MLG, 1FLE, 3V89, 3I84). Regenerate graph tensors or adjust coverage settings to proceed safely.
2025-12-31 21:20:36 INFO Graph cache enabled (max_items=256). Disable via selection cache.enable_graph_cache=false in config.
2025-12-31 21:20:36 INFO Tuning group stats: groups=1285 groups>=2=207 singletons=1078 max_group=31
2025-12-31 21:20:36 INFO Dataset coverage report written to /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/dataset_coverage.json
2025-12-31 21:20:36 ERROR [coverage] train split: 37/8723 labels missing graph tensors (coverage 99.58%). See /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/dataset_coverage.json for details.
2025-12-31 21:20:36 ERROR [coverage] val split: 21/3397 labels missing graph tensors (coverage 99.38%). See /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/dataset_coverage.json for details.
2025-12-31 21:20:36 ERROR [coverage] tuning split: 8/2181 labels missing graph tensors (coverage 99.63%). See /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/dataset_coverage.json for details.
2025-12-31 21:20:36 INFO Schema summary written to /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/schema_summary.json
2025-12-31 21:20:36 INFO Feature metadata written to /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/feature_metadata.json
2025-12-31 21:20:36 INFO Graph builder: graph_builder2 (version 2.0.0)
2025-12-31 21:20:36 INFO Feature config snapshot: path=/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/feature_configs/feature-config.yaml.topoqa.10A.2, sha256=5c62898155179232a565e24d9fbd7b208f9ce480d1a19d6139de19454e173ff0
2025-12-31 21:20:36 INFO Edge dumps: enabled (output: /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/work/edge_features)
2025-12-31 21:20:36 INFO Feature metadata source: /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/graph_data/graph_metadata.json
2025-12-31 21:20:36 INFO Graph builder summary: /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/schema_summary.json
2025-12-31 21:20:36 INFO Interface: interface/polar_cutoff/v1 (cutoff 10 Å), yielding 10 interface residues.
2025-12-31 21:20:36 INFO Topology: topology/persistence_basic/v1 (filtration_cutoff 8 Å, min_persistence 0.01) supporting the 172-dimensional node features.
2025-12-31 21:20:36 INFO Node: node/dssp_topo_merge/v1; metadata lists 172 feature columns matching the .pt tensor.
2025-12-31 21:20:36 INFO Edge: edge/legacy_band/v11 (variant legacy_v11); .pt confirms 40 directed edges with 11 feature values each.
2025-12-31 21:20:36 INFO → Total feature dimensionality observed and confirmed: node_dim = 172, edge_dim = 11.
2025-12-31 21:20:36 INFO Secondary selection metric enabled: val_spearman_corr (weight=1.000, min_delta=0.000)
2025-12-31 21:20:36 INFO Resolved feature metadata: {
  "edge_schema": {
    "dim": 11,
    "module": "edge/legacy_band/v11",
    "variant": "legacy_v11",
    "module_params": {
      "distance_max": 10.0,
      "distance_min": 0.0,
      "jobs": 16,
      "scale_features": true
    },
    "source": "/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/graph_data/graph_metadata.json",
    "alias": "10D atomic distances between two residues + 1D distance between C (alpha) = Edge 11D | TopoQA",
    "jobs": 16,
    "summary": "11-D legacy edge features (distance + atom distance histogram)."
  },
  "node_schema": {
    "dim": 172,
    "source": "/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/graph_data/graph_metadata.json",
    "module": "node/dssp_topo_merge/v1",
    "module_params": {
      "drop_na": true,
      "jobs": 16
    },
    "column_count": 172,
    "columns_preview": [
      "rasa",
      "phi",
      "psi",
      "SS8_0",
      "SS8_1"
    ]
  },
  "metadata_path": "/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/topoqa_10A_ARM/graph_data/graph_metadata.json",
  "summary_path": "/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/schema_summary.json",
  "module_registry": {
    "edge": {
      "id": "edge/legacy_band/v11",
      "alias": "10D atomic distances between two residues + 1D distance between C (alpha) = Edge 11D | TopoQA",
      "jobs": 16,
      "summary": "11-D legacy edge features (distance + atom distance histogram)."
    },
    "interface": {
      "id": "interface/polar_cutoff/v1",
      "alias": "residue ID + 3D coordinates (x,y,z) default cutoff 10A | TopoQA",
      "jobs": 16,
      "summary": "Polar interface detection using distance cutoff. ID + coords for downstream stages"
    },
    "node": {
      "id": "node/dssp_topo_merge/v1",
      "alias": "140D PH (topology summaries on interface coords) + 32D DSSP = Node 172D | TopoQA",
      "jobs": 16,
      "summary": "DSSP-derived node features merged with topology statistics."
    },
    "topology": {
      "id": "topology/persistence_basic/v1",
      "alias": "Betti 0 and Betti 1 topology summaries on interface coords = 140D PH | TopoQA",
      "jobs": 16,
      "summary": "Persistent homology features with configurable distance thresholds."
    }
  },
  "notes": []
}
2025-12-31 21:20:36 INFO Detected macOS with num_workers=2. If you observe instability, revert to 0 in config.yaml.
2025-12-31 21:20:36 INFO Weight averaging enabled (ema) -> /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/model_checkpoints/averaged_ema.ckpt
2025-12-31 21:20:37 INFO MLflow logging enabled (experiment=dynamic_topoqa, run_id=882c82c239534d91a475d4c3b47e7e59)
GPU available: True (mps), used: False
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
2025-12-31 21:20:37 INFO Starting training (fast_dev_run=False)
2025-12-31 21:20:37 INFO Detected GPU/MPS hardware. Current run uses accelerator='cpu' (configurable via config.yaml -> accelerator).
/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/venv_qtopo/lib/python3.10/site-packages/pytorch_lightning/callbacks/model_checkpoint.py:701: Checkpoint directory /Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/QTopoQA/qtdaqa/new_dynamic_features/model_training2/training_runs2/sched_boost_lean_seed222_2025-12-31_21-20-31/model_checkpoints exists and is not empty.

   | Name         | Type             | Params | Mode 
-----------------------------------------------------------
0  | criterion    | MeanSquaredError | 0      | train
1  | relu         | ReLU             | 0      | train
2  | sigmoid      | Sigmoid          | 0      | train
3  | edge_embed   | ModuleList       | 1.5 K  | train
4  | embed        | ModuleList       | 5.5 K  | train
5  | conv1        | ModuleList       | 50.2 K | train
6  | conv2        | ModuleList       | 50.2 K | train
7  | conv3        | ModuleList       | 50.2 K | train
8  | fc_edge      | Linear           | 528    | train
9  | protein_fc_1 | ModuleList       | 3.1 K  | train
10 | fc1          | Linear           | 4.2 K  | train
11 | out          | Linear           | 65     | train
-----------------------------------------------------------
165 K     Trainable params
0         Non-trainable params
165 K     Total params
0.662     Total estimated model params size (MB)
37        Modules in train mode
0         Modules in eval mode
/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/venv_qtopo/lib/python3.10/site-packages/pytorch_lightning/trainer/connectors/data_connector.py:428: Consider setting `persistent_workers=True` in 'val_dataloader' to speed up the dataloader worker initialization.
USING ADAM
/Volumes/PData/Data/Dev/Github/Repos/phd3/qtopo/venv_qtopo/lib/python3.10/site-packages/pytorch_lightning/trainer/connectors/data_connector.py:428: Consider setting `persistent_workers=True` in 'train_dataloader' to speed up the dataloader worker initialization.
2025-12-31 21:20:52 INFO Epoch 000 | 25% complete (batch 46/181)
2025-12-31 21:20:53 INFO Epoch 000 | 50% complete (batch 91/181)
2025-12-31 21:20:54 INFO Epoch 000 | 75% complete (batch 136/181)
2025-12-31 21:21:02 INFO Selection metric (val_loss - 1.000*max(0,val_spearman_corr-0.000)) = 0.140718
2025-12-31 21:21:15 INFO Tuning ranking metrics: regret=0.138429 spearman=-0.027400 (groups=207, skipped=1078)
2025-12-31 21:21:15 INFO Tuning DockQ metrics: mae=0.362924 hit_rate_023=0.668116 (groups=207, skipped=1078)
2025-12-31 21:21:15 INFO Epoch 000 | val_loss=0.140718
Metric val_loss improved. New best score: 0.141
2025-12-31 21:21:24 INFO Epoch 001 | 25% complete (batch 46/181)
2025-12-31 21:21:25 INFO Epoch 001 | 50% complete (batch 91/181)
2025-12-31 21:21:26 INFO Epoch 001 | 75% complete (batch 136/181)
2025-12-31 21:21:35 INFO Selection metric (val_loss - 1.000*max(0,val_spearman_corr-0.000)) = -0.137793
2025-12-31 21:21:47 INFO Tuning ranking metrics: regret=0.156111 spearman=-0.080654 (groups=207, skipped=1078)
2025-12-31 21:21:47 INFO Tuning DockQ metrics: mae=0.363979 hit_rate_023=0.667150 (groups=207, skipped=1078)
2025-12-31 21:21:47 INFO Epoch 001 | train_mse=0.144865 | val_loss=0.142340 | best_val_loss=0.140718
2025-12-31 21:21:56 INFO Epoch 002 | 25% complete (batch 46/181)
2025-12-31 21:21:56 INFO Epoch 002 | 50% complete (batch 91/181)
2025-12-31 21:21:57 INFO Epoch 002 | 75% complete (batch 136/181)
2025-12-31 21:22:06 INFO Selection metric (val_loss - 1.000*max(0,val_spearman_corr-0.000)) = 0.140757
2025-12-31 21:22:19 INFO Tuning ranking metrics: regret=0.183506 spearman=-0.180342 (groups=207, skipped=1078)
2025-12-31 21:22:19 INFO Tuning DockQ metrics: mae=0.363294 hit_rate_023=0.668116 (groups=207, skipped=1078)
2025-12-31 21:22:19 INFO Epoch 002 | train_mse=0.151277 | val_loss=0.140757 | best_val_loss=0.140718
2025-12-31 21:22:27 INFO Epoch 003 | 25% complete (batch 46/181)
2025-12-31 21:22:28 INFO Epoch 003 | 50% complete (batch 91/181)
2025-12-31 21:22:29 INFO Epoch 003 | 75% complete (batch 136/181)
2025-12-31 21:22:38 INFO Selection metric (val_loss - 1.000*max(0,val_spearman_corr-0.000)) = 0.140202
2025-12-31 21:22:51 INFO Tuning ranking metrics: regret=0.128718 spearman=0.037558 (groups=207, skipped=1078)
2025-12-31 21:22:51 INFO Tuning DockQ metrics: mae=0.362342 hit_rate_023=0.672947 (groups=207, skipped=1078)
2025-12-31 21:22:51 INFO Epoch 003 | train_mse=0.155567 | val_loss=0.140202 | best_val_loss=0.140718
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.140
