Generating graph-dir manifest for advanced_heavy_10A_edge_min_topo_lean ...
[validate_graphs] Manifest written: ../graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data/graph_manifest.json
[validate_graphs] OK: validated 14390 graph(s) in /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data

real    45m25.542s
user    53m14.800s
sys     3m19.369s
Done with manifest for advanced_heavy_10A_edge_min_topo_lean ...
3194.80user 199.36system 45:25.54elapsed 124%CPU (0avgtext+0avgdata 3594676maxresident)k
696459416inputs+10104outputs (1major+156995744minor)pagefaults 0swaps
Skipped Validating graphs using standalone tool ...
Starting model training ...
[run_full_pipeline] Validating graphs before training...
[validate_graphs] OK: validated 14390 graph(s) in /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data
[run_full_pipeline] Starting sweep at 2025-12-16T23:44:39.439149+00:00 using manifest /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/manifests/run_lean.yaml
[train_cli][batch] (1/3) running job 'sched_boost_lean_seed222' -> run_name=sched_boost_lean_seed222_2025-12-16_23-44-39
[train_cli] run_id=sched_boost_lean_seed222_2025-12-16_23-44-39 | command=/home/app/venv_qtopo/bin/python /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/model_train_topoqa_cpu.py --config /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/config/config.yaml --run-dir /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39 --git-commit dc39ad5638 --git-dirty
2025-12-16 23:44:42 INFO git_commit = dc39ad5638 (dirty)
2025-12-16 23:44:42 INFO Training package root: /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training2025-12-16 23:44:42 INFO Configuration loaded from /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/config/config.yaml
2025-12-16 23:44:42 INFO   graph_dir = /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data
2025-12-16 23:44:42 INFO   train_label_file = /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/data.train.csv
2025-12-16 23:44:42 INFO   val_label_file = /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/data.validate.csv
2025-12-16 23:44:42 INFO   save_dir = /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39
2025-12-16 23:44:42 INFO   metadata_path = None
2025-12-16 23:44:42 INFO   summary_path = None
2025-12-16 23:44:42 INFO   accelerator = cpu
2025-12-16 23:44:42 INFO   devices = 1
2025-12-16 23:44:42 INFO   attention_head = 8
2025-12-16 23:44:42 INFO   pooling_type = mean
2025-12-16 23:44:42 INFO   batch_size = 16
2025-12-16 23:44:42 INFO   learning_rate = 0.005
2025-12-16 23:44:42 INFO   num_epochs = 140
2025-12-16 23:44:42 INFO   accumulate_grad_batches = 16
2025-12-16 23:44:42 INFO   seed = 222
2025-12-16 23:44:42 INFO   num_workers = 0
2025-12-16 23:44:42 INFO   precision = 32
2025-12-16 23:44:42 INFO   lr_scheduler_type = reduce_on_plateau
2025-12-16 23:44:42 INFO   early_stopping_patience = 24
2025-12-16 23:44:42 INFO   lr_scheduler_patience = 6
2025-12-16 23:44:42 INFO   lr_scheduler_factor = 0.2
2025-12-16 23:44:42 INFO   fast_dev_run = False
2025-12-16 23:44:42 INFO   limit_train_batches = None
2025-12-16 23:44:42 INFO   limit_val_batches = None
2025-12-16 23:44:42 INFO   log_lr = False
2025-12-16 23:44:42 INFO   progress_bar_refresh_rate = 0
2025-12-16 23:44:42 INFO   log_every_n_steps = 100
2025-12-16 23:44:42 INFO   use_val_spearman_as_secondary = True
2025-12-16 23:44:42 INFO   spearman_secondary_min_delta = 0.0
2025-12-16 23:44:42 INFO   spearman_secondary_weight = 1.0
2025-12-16 23:44:42 INFO   selection_primary_metric = val_loss
2025-12-16 23:44:42 INFO   coverage_minimum = 0.0
2025-12-16 23:44:42 INFO   coverage_fail_on_missing = False
2025-12-16 23:44:42 INFO   graph_load_profiling = False
2025-12-16 23:44:42 INFO   graph_load_top_k = 5
2025-12-16 23:44:42 INFO   enable_graph_cache = True
2025-12-16 23:44:42 INFO   graph_cache_size = 256
2025-12-16 23:44:42 INFO   canonicalize_on_load = False
2025-12-16 23:44:42 INFO   mlflow = MlflowConfig(enabled=True, tracking_uri='./qtdaqa/new_dynamic_features/model_training/ml_runs', experiment='dynamic_topoqa', run_name=None, log_artifacts=True, tags={})
2025-12-16 23:44:42 INFO   edge_schema = {}
2025-12-16 23:44:42 INFO   topology_schema = {}
Seed set to 222
2025-12-16 23:44:42 INFO [train] label rows: 8723 | usable graphs: 8685 | coverage: 99.56%
2025-12-16 23:44:42 ERROR [train] 38 label entries missing matching .pt graphs (first examples: 1A9X, 1FLE, 1HT9, 1OAO, 1R0R). Regenerate graph tensors or adjust coverage settings to proceed safely.
2025-12-16 23:44:42 INFO [val] label rows: 3397 | usable graphs: 3376 | coverage: 99.38%
2025-12-16 23:44:42 ERROR [val] 21 label entries missing matching .pt graphs (first examples: 1H59, 2B5L, 2C7M, 2GZH, 2W19). Regenerate graph tensors or adjust coverage settings to proceed safely.
2025-12-16 23:44:45 INFO Graph cache enabled (max_items=256). Disable via selection cache.enable_graph_cache=false in config.
2025-12-16 23:44:45 INFO Dataset coverage report written to /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/dataset_coverage.json
2025-12-16 23:44:45 ERROR [coverage] train split: 38/8723 labels missing graph tensors (coverage 99.56%). See /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/dataset_coverage.json for details.
2025-12-16 23:44:45 ERROR [coverage] val split: 21/3397 labels missing graph tensors (coverage 99.38%). See /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/dataset_coverage.json for details.
2025-12-16 23:44:45 INFO Schema summary written to /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/schema_summary.json
2025-12-16 23:44:45 INFO Feature metadata written to /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/feature_metadata.json
2025-12-16 23:44:45 INFO Graph builder: graph_builder2 (version 2.0.0)
2025-12-16 23:44:45 INFO Feature config snapshot: path=/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/feature_configs/advanced_k_partite/feature-config.yaml.advanced_heavy.10A.edge.min.topo.lean, sha256=098772dc5d4adceddbd25969251da48fe0c7a7d73769d6e3993b0a59eb2f0cd1
2025-12-16 23:44:45 INFO Edge dumps: enabled (output: /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/work/edge_features)
2025-12-16 23:44:45 INFO Feature metadata source: /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data/graph_metadata.json
2025-12-16 23:44:45 INFO Graph builder summary: /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/schema_summary.json
2025-12-16 23:44:45 INFO Interface: interface/polar_cutoff/v1 (cutoff 10 Å), yielding 10 interface residues.
2025-12-16 23:44:45 INFO Topology: topology/persistence_k_partite_advanced/v1 (filtration_cutoff 8 Å, min_persistence 0.01) supporting the 172-dimensional node features.
2025-12-16 23:44:45 INFO Node: node/dssp_topo_merge/v1; metadata lists 172 feature columns matching the .pt tensor.
2025-12-16 23:44:45 INFO Edge: edge/edge_plus_min_agg_topo/v1 (variant edge_plus_min_agg_topo/lean); .pt confirms 40 directed edges with 6014 feature values each.
2025-12-16 23:44:45 INFO → Total feature dimensionality observed and confirmed: node_dim = 172, edge_dim = 6014.
2025-12-16 23:44:45 INFO Secondary selection metric enabled: val_spearman_corr (weight=1.000, min_delta=0.000)
2025-12-16 23:44:45 INFO Resolved feature metadata: {
  "edge_schema": {
    "dim": 6014,
    "module": "edge/edge_plus_min_agg_topo/v1",
    "variant": "edge_plus_min_agg_topo/lean",
    "module_params": {
      "distance_max": 10.0,
      "distance_min": 0.0,
      "include_cosine": true,
      "include_minmax": false,
      "include_norms": true,
      "jobs": 8,
      "scale_histogram": true,
      "variant": "lean"
    },
    "source": "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data/graph_metadata.json",
    "alias": "Legacy 11D Edge + 423D {(norm + cosine) from 140D PH} = Edge 434D (Lean) | Legacy 11D Edge + 703D {(norm + cosine + minmax) from 140D PH} = Edge 714D (Heavy)",
    "jobs": 8,
    "summary": "Legacy 11D histogram plus per-residue topology concat+abs-diff+cosine (lean)."
  },
  "node_schema": {
    "dim": 172,
    "source": "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data/graph_metadata.json",
    "column_count": 172,
    "columns_preview": [
      "rasa",
      "phi",
      "psi",
      "SS8_0",
      "SS8_1"
    ]
  },
  "metadata_path": "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/graph_builder2/output/advanced_heavy_10A_edge_min_topo_lean/graph_data/graph_metadata.json",
  "summary_path": "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/schema_summary.json",
  "module_registry": {
    "edge": {
      "id": "edge/edge_plus_min_agg_topo/v1",
      "alias": "Legacy 11D Edge + 423D {(norm + cosine) from 140D PH} = Edge 434D (Lean) | Legacy 11D Edge + 703D {(norm + cosine + minmax) from 140D PH} = Edge 714D (Heavy)",
      "jobs": 8,
      "summary": "Legacy 11D histogram plus per-residue topology concat+abs-diff+cosine (lean)."
    },
    "interface": {
      "id": "interface/polar_cutoff/v1",
      "alias": "residue ID + 3D coordinates (x,y,z) default cutoff 10A | TopoQA",
      "jobs": 8,
      "summary": "Polar interface detection using distance cutoff. ID + coords for downstream stages"
    },
    "node": {
      "id": "node/dssp_topo_merge/v1",
      "alias": "140D PH (topology summaries on interface coords) + 32D DSSP = Node 172D | TopoQA",
      "jobs": 8,
      "summary": "DSSP-derived node features merged with topology statistics."
    },
    "topology": {
      "id": "topology/persistence_k_partite_advanced/v1",
      "alias": "Advanced k-partite PH (heavy) \u2248 700D (bias+polar+typed)",
      "jobs": 8,
      "summary": "Advanced k-partite persistent homology with optional typed-contact and weighted/polar blocks."
    }
  },
  "notes": [
    "Inconsistent edge feature_dim: encountered 4754 but expected 3494",
    "Inconsistent edge feature dimension derived from graphs: [3494, 4754, 6014]",
    "edge feature dimension mismatch between metadata (3494) and graphs (6014); using 6014"
  ]
}
2025-12-16 23:44:45 INFO DataLoader num_workers=0; consider increasing num_workers in config.yaml to >1 for better throughput on non-macOS systems.
/home/app/venv_qtopo/lib/python3.11/site-packages/mlflow/tracking/_tracking_service/utils.py:140: FutureWarning: Filesystem tracking backend (e.g., './mlruns') is deprecated. Please switch to a database backend (e.g., 'sqlite:///mlflow.db'). For feedback, see: https://github.com/mlflow/mlflow/issues/18534
  return FileStore(store_uri, store_uri)
Experiment with name dynamic_topoqa not found. Creating it.
2025-12-16 23:44:46 INFO MLflow logging enabled (experiment=dynamic_topoqa, run_id=a40120a690784f98853f777c16fd6443)
/home/app/venv_qtopo/lib/python3.11/site-packages/torch/cuda/__init__.py:628: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
2025-12-16 23:44:46 INFO Starting training (fast_dev_run=False)
/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/callbacks/model_checkpoint.py:701: Checkpoint directory /home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/training_runs/sched_boost_lean_seed222_2025-12-16_23-44-39/model_checkpoints exists and is not empty.

   | Name         | Type             | Params | Mode
-----------------------------------------------------------
0  | criterion    | MeanSquaredError | 0      | train
1  | relu         | ReLU             | 0      | train
2  | sigmoid      | Sigmoid          | 0      | train
3  | edge_embed   | ModuleList       | 193 K  | train
4  | embed        | ModuleList       | 5.5 K  | train
5  | conv1        | ModuleList       | 50.2 K | train
6  | conv2        | ModuleList       | 50.2 K | train
7  | conv3        | ModuleList       | 50.2 K | train
8  | fc_edge      | Linear           | 528    | train
9  | protein_fc_1 | ModuleList       | 3.1 K  | train
10 | fc1          | Linear           | 4.2 K  | train
11 | out          | Linear           | 65     | train
-----------------------------------------------------------
357 K     Trainable params
0         Non-trainable params
357 K     Total params
1.431     Total estimated model params size (MB)
37        Modules in train mode
0         Modules in eval mode
[FATAL] Edge feature dimension mismatch: expected 6014, got 4754
USING ADAM
Traceback (most recent call last):
  File "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/model_train_topoqa_cpu.py", line 2147, in <module>
    raise SystemExit(main())
                     ^^^^^^
  File "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/model_train_topoqa_cpu.py", line 1882, in main
    trainer.fit(
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/trainer.py", line 561, in fit
    call._call_and_handle_interrupt(
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/call.py", line 49, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/trainer.py", line 599, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/trainer.py", line 1012, in _run
    results = self._run_stage()
              ^^^^^^^^^^^^^^^^^
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/trainer.py", line 1054, in _run_stage
    self._run_sanity_check()
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/trainer.py", line 1083, in _run_sanity_check
    val_loop.run()
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/loops/utilities.py", line 179, in _decorator
    return loop_run(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 145, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 437, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/trainer/call.py", line 329, in _call_strategy_hook
    output = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/app/venv_qtopo/lib/python3.11/site-packages/pytorch_lightning/strategies/strategy.py", line 412, in validation_step
    return self.lightning_module.validation_step(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/model/gat_5_edge1.py", line 332, in validation_step
    batch_scores = self.forward(val_batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/app/phd/github/QTopoQA/qtdaqa/new_dynamic_features/model_training/model/gat_5_edge1.py", line 218, in forward
    raise ValueError(f"Edge feature dimension mismatch: expected {self.edge_dim}, got {edge_attr.size(-1)}")
ValueError: Edge feature dimension mismatch: expected 6014, got 4754
[train_cli][batch] job 'sched_boost_lean_seed222' failed: Training command exited with status 1
[train_cli] ERROR: Training command exited with status 1
Starting post model training polishing ...
3166.16user 219.04system 45:32.38elapsed 123%CPU (0avgtext+0avgdata 3644720maxresident)k
697473496inputs+632outputs (894major+190773247minor)pagefaults 0swaps
