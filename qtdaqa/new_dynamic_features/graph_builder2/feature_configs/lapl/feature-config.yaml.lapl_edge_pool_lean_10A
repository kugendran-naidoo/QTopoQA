# Auto-generated feature-config template
# Pick one module per required stage. Edit parameter values as needed.
# Run `./run_graph_builder2.sh --list-modules` for detailed descriptions.
defaults:
  jobs: 16  # Optional global worker override; remove if unused.

options:
  topology_round_decimals: 12  # Round topology numeric columns to N decimals (0-15); -1 or omit to disable (recommended 12 when enabling).

# REQUIRED stage: interface
interface:
  module: interface/polar_cutoff/v1  # alias: n x 3D TopoQA default 10A cutoff
  alias: "residue ID + 3D coordinates (x,y,z) default cutoff 10A | TopoQA"
  summary: "Polar interface detection using distance cutoff."
  description: "Identifies interface residues across chains using the polar interface routine (new_calculate_interface.process_pdb_file) with configurable distance cutoff and coordinate rounding."
  params:
    cutoff: 10.0
    coordinate_decimals: -1  # skip rounding to keep raw coords
    jobs: 16

# OPTIONAL stage: topology
topology:
  module: topology/persistence_laplacian_hybrid/v1  # alias: 140D topology + 32D Laplacian
  alias: "140D PH (Betti 0 and Betti 1 topology summaries on interface coords) + 32D Laplacian = 172D"
  summary: "Persistent homology + Laplacian spectral moments per interface residue."
  description: "Extends the 140D persistent homology descriptors with Laplacian spectral features computed on local interface residue graphs (cross-chain by default). Laplacian block includes per-eigen values, spectral stats, entropy, moments, and heat traces."
  params:
    neighbor_distance: 8.0
    filtration_cutoff: 8.0
    min_persistence: 0.01
    dedup_sort: false
    element_filters:
      - [C]
      - [N]
      - [O]
      - [C, N]
      - [C, O]
      - [N, O]
      - [C, N, O]
    lap_graph_mode: cross_chain  # cross_chain (default) or all to include same-chain neighbors
    lap_distance_cutoff: 8.0
    lap_k_neighbors: null  # optional deterministic k-NN cap; otherwise cutoff-based
    lap_edge_weight: gaussian  # gaussian (default, sigma ~ neighbor_distance/2), inverse, or binary
    lap_sigma: 4.0
    lap_eigs_count: 16
    lap_moment_orders: [1, 2, 3, 4]
    lap_heat_times: [0.1, 1.0, 5.0]
    lap_include_entropy: true
    lap_max_neighbors: 128  # cap neighborhood size (includes target residue)
    lap_normalize: sym
    jobs: 16

# REQUIRED stage: node
node:
  module: node/dssp_topo_merge_passthrough/v1  # alias: Passthrough (all dims from topology module) + 32D DSSP = Node Dynamic Dims
  alias: "Passthrough (all dims from topology module) + 32D DSSP = Node Dynamic Dims"
  summary: "DSSP/basic features merged with all topology columns (passthrough)."
  description: "Runs DSSP/basic feature extraction and merges with the provided topology CSV using all non-ID topology columns (no hardcoded list). Topology columns are MinMax scaled per file; output columns ordered as ID, DSSP/basic 32D, then topology columns in file order. Suitable for hybrid topology (PH+Lap) or any dynamic topo layout."
  params:
    drop_na: true  # matches fea_df_clean = fea_df.dropna() in both inference_model.py and k_mac_inference_pca_tsne4.py
    jobs: 16

# REQUIRED stage: edge
edge:
  module: edge/edge_plus_pool_agg_lap_hybrid/v1  # alias: 11D Legacy + hybrid topo (PH+Lap 172D)
  alias: "Legacy 11D Edge + 1382D {(hist + endpoint agg + pooled agg) from 172D laplacian_hybrid} = Edge 1393D (Lean)"
  summary: "Legacy 11D histogram + hybrid pooled topo agg (PH+Lap 172D)."
  description: "Same aggregation as edge_plus_pool_agg_topo/v1, intended for use with topology/persistence_laplacian_hybrid/v1 (per-residue PH + Laplacian vectors, expected topo_dim\u2248172). Prepends the legacy 11D distance histogram, then applies balanced aggregation on endpoints and pooled neighbor means (concat, mean, abs-diff, optional norms/cosine); heavy variant adds per-dimension min/max. Deterministic edge ordering (src_idx, dst_idx, distance) preserved."
  params:
    distance_min: 0.0
    distance_max: 10.0
    scale_histogram: true
    include_norms: true
    include_cosine: true
    pool_k: 5  # number of nearest interface residues to pool per endpoint (default 5)
    include_minmax: false  # heavy variant only; adds per-dimension min/max blocks to endpoint and pooled agg
    variant: lean  # lean or heavy
    jobs: 16
